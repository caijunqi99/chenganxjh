{include file="public/header" /}
<div id="append_parent"></div>
<div id="ajaxwaitid"></div>
 <link rel="stylesheet" href="{$Think.config.url_domain_root}static/plugins/layer/css/layui.css">       

<div class="page">
    <div class="fixed-bar">
        <div class="item-title">
            <div class="subject">
                <h3>打卡记录</h3>
                <h5></h5>
            </div>
            {include file="public/admin_items" /}
        </div>
    </div>
    <form method="get" name="formSearch" id="formSearch">
        <table class="search-form">
            <tbody>
                <tr>
                    <td> <label>学生姓名：</label></td>
                    <td> <input type="text" class="text w150" name="studentname" value="{$Think.get.studentname}"></td>
                    <td id="type_list">
                        <select name="school_type" id="school_type" onchange="fand_classname($(this))">
                            <option value="">年级</option>
                            {volist name="schooltype" id="type"}
                            <option value="{$type.sc_id}" {if condition='$Think.get.school_type eq $type.sc_id'}selected='selected'{/if}>{$type.sc_type}</option>
                            {/volist}
                        </select>
                    </td>

                    <td id="class_list">
                        <select name="class_name" >
                            <option value="">班级名称</option>
                            {volist name="classList" id="v"}
                            <option value="{$v.classid}" {if condition='$Think.get.class_name eq $v.classid'}selected='selected'{/if}>{$v.classname}</option>
                            {/volist}
                        </select>
                    </td>
                    <td> <label>时间：</label></td>
                    <td>
                        <input type="text" class="txt date" name="query_start_time" id="query_start_time" value="{$Think.get.query_start_time}" placeholder="请输入开始时间">
                        &nbsp;–&nbsp;
                        <input id="query_end_time" class="txt date" type="text" name="query_end_time" value="{$Think.get.query_end_time}" placeholder="请输入结束时间">
                    </td>
                    <td>
                        <input type="submit" class="submit" value="搜索">
                    </td>
                </tr>
            </tbody>
        </table>
    </form>
    <div class="explanation" id="explanation">
        <div class="title" id="checkZoom">
            <h4 title="提示相关设置操作时应注意的要点">操作提示</h4>
            <span id="explanationZoom" title="收起提示" class="arrow"></span>
        </div>
        <ul>
            <li>默认显示所有学生当天打卡记录</li>
        </ul>
    </div>

    <table class="ds-default-table">
      <thead>
        <tr class="thead">
          <th class="align-center"><span>ID</span></th>
          <th class="align-center"><span>学生id</span></th>
          <th class="align-center"><span>学生姓名</span></th>
          <th class="align-center"><span>班级</span></th>
          <th class="align-center"><span>年级</span></th>
          <th class="align-center"><span>早晚考勤标识</span></th>
          <th class="align-center"><span>打卡时间</span></th>
          <th class="align-center"><span>打卡视频链接</span></th>
          <th class="align-center"><span>机器人标识</span></th>
        </tr>
      <tbody>
        <?php if(!empty($recordInfo) && is_array($recordInfo)){ ?>
        <?php foreach($recordInfo as $k => $v){ ?>
        <tr class="hover member">
            <td class="align-center"><?php if(!$_GET['page']){  echo $k+1; }else{ echo ($_GET['page']-1)*15+$k+1; }?></td>
          <td class="align-center"><?php echo $v['student_id']; ?></td>
          <td class="align-center"><?php echo $v['s_name']; ?></td>
          <td class="align-center"><?php echo $v['classname']; ?></td>
          <td class="align-center"><?php echo $v['sc_type']; ?></td>
          <td class="align-center"><?php if($v['ioFlag']==1){echo "早";}else{echo "晚";} ?></td>
          <td class="align-center"><?php echo date("Y-m-d H:i:s",$v['ioTime']); ?></td>
          <td class="align-center"><?php echo $path.$v['ioVideo']; ?></td>
          <td class="align-center"><?php echo $v['SNNumber']; ?></td>
        </tr>
        <?php } ?>
        <?php }else { ?>
        <tr class="no_data">
          <td colspan="11">{$Think.lang.ds_no_record}</td>
        </tr>
        <?php } ?>
      </tbody>
      <script type="text/javascript">
          function fand_classname(_sef) {
              var ty_id = $(_sef).val();
              if(ty_id) {
                  var url = SITE_URL + 'index.php/School/Student/fand_classname';
                  $.post(url, {'ty_id': ty_id}, function (data) {
                      data = $.parseJSON(data);
                      var classname_length = data.length;
                      var classname_list = data;
                      if (data) {
                          var select = '<select name="class_name" id="class_name" class="querySelect"><option value="">请选择班级</option>';
                          if (classname_length > 0) {
                              for (var i = 0; i < classname_length; i++) {
                                  select += "<option value='" + classname_list[i].classid + "'>" + classname_list[i].classname + "</option>";
                              }
                          }
                          select += '</select>';
                          $("#class_list").html(select);
                      } else {
                          alert(data.message);
                      }
                  });
              }
          }
        function robot_drop(id){
          layer.confirm('是否禁用此机器人？', {
            btn: ['删除','取消'] //按钮
          }, function(){
            window.location.href="{:url('/admin/robot/drop')}?robot_id="+id;
          });
        }
      </script>
    </table>
    {$page}
    
</div>