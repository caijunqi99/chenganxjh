<?php
/**
 * Created by PhpStorm.
 * User: Administrator
 * Date: 2017/8/16
 * Time: 20:12
 */

namespace app\wap\controller;


class Teacherchild extends MobileMember
{
    public function _initialize()
    {
        parent::_initialize(); // TODO: Change the autogenerated stub
    }

    //我的上传
    public function myUpload(){
        $member_id = input('post.member_id');
        if(empty($member_id)){
            output_error('member_id参数有误');
        }
        $teachchild = model('Teachchild');
        $condition = array();
        $condition['t_userid'] = $member_id;
        if(input('post.status')){
            if(input('post.status')==3){
                $condition['t_audit'] = 3;
            }elseif(input('post.status')==1){
                $condition['t_audit'] = array('between',array(1,2));
            }
        }else{
            $condition['t_audit'] = array('between',array(1,2));
        }
        $page = !empty(input('post.page'))?input('post.page'):1;
        $list = $teachchild->getTeachchildList($condition,'',$page,'t_id desc',10);
        output_data($list);
    }

    //我的视频/我的订单
    public function myVideos(){
        $member_id = input('post.member_id');
        $page = !empty(input('post.page'))?input('post.page'):1;
        $start = ($page-1)*10;
        $result = db('packagesorderteach')->field("order_id,order_sn,order_name,order_tid,order_dieline,add_time,payment_time,order_amount")->where(array('delete_state'=>0,'buyer_id'=>$member_id))->order('add_time',desc)->limit($start,10)->select();
        foreach($result as $k=>$v){
            $result[$k]['date'] = date("Y-m-d",$v['add_time']);
            if(date("Y-m-d",time()) == date("Y-m-d",$v['add_time'])){
                $result[$k]['date'] = "今天";
            }
            $videoinfo = db('teachchild')->where(array('t_id'=>$v['order_tid']))->find();
            $result[$k]['title'] = $videoinfo['t_title'];
            $result[$k]['videoimg'] = $videoinfo['t_videoimg'];
            $result[$k]['videourl'] = $videoinfo['t_url'];
            $result[$k]['author'] = $videoinfo['t_author'];
            $result[$k]['order_dieline'] = date("Y-m-d H:i:s",$v['order_dieline']);
            $result[$k]['payment_time'] = date("Y-m-d H:i:s",$v['payment_time']);
        }
        foreach($result as $key=>$item){
            $data[$item['date']][] = $item;
        }
        $data = isset($data)?[$data]:[];
        output_data($data);
    }

}