<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8" />
    <title>想见孩-个人信息</title>
    <meta name="author" content="想见孩" />
    <meta name="copyright" content="想见孩" />
    <meta name="description" content="想见孩" />
    <meta id="viewport" name="viewport" content="width=750" />
    <link rel="stylesheet" href="../content/style/reset.css" type="text/css" />
    <link rel="stylesheet" href="../content/plugins/iconfonts/iconfont.css" type="text/css" />
    <link rel="stylesheet" href="../content/plugins/jqweui/lib/weui.css" type="text/css" />
    <link rel="stylesheet" href="../content/plugins/jqweui/css/jquery-weui.css" type="text/css" />
    <link rel="stylesheet" href="../content/style/common.css" type="text/css" />
    <link rel="stylesheet" href="../content/style/user.css" type="text/css" />
    <link rel="shortcut icon" href="../content/images/ico.ico" type="image/x-icon" />
    <script src="../content/scripts/mobile-util.js"></script>
</head>

<body class="infobody" ontouchstart>
    <header class="head">
        <div class="head0">
            <div class="menu_bar_box">
                <a href="javascript:;" class="back_btn" onClick="javascript:history.back(-1);">
                    <i class="icon iconfont icon-jiantou3"></i>
                </a>
            </div>
            <div class="head_title">
                <p>人个信息</p>
            </div>
            <div class="head_r">

            </div>
        </div>
    </header>

    <!-- 主要内容 -->
    <div class="main">
        <div class="cont margt30">
            <div class="container2">
                <div class="bang_list userhead" style="position:relative;">
                    <div class="name_box user_head_txt">
                        <label for="picture" class="picture_label">头像</label>
                        <input type="file" placeholder="" id="picture" onchange="fileChange(event)" style="visibility:hidden;width: 0;height: 0;" />
                    </div>
                    <div class="input_box user_head_cont" style="float:right;">
                        <div class="user_head_box">
                            <img src="../content/images/user/user_head.jpg" alt="" class="user_img">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="cont">
            <div class="container2">
                <div class="bang_list">
                    <div class="name_box">
                        <label for="nickname">昵称</label>
                    </div>
                    <div class="input_box">
                        <input class="input_txt" id="nickname" type="text" placeholder="" value="18518787797" />
                    </div>
                </div>

                <div class="weui-cell bang_list">
                    <div class="weui-cell__hd name_box"><label for="shenfen" class="weui-label">身份</label></div>
                    <div class="weui-cell__bd">
                        <input class="weui-input input_txt inputpointer" id="shenfen" type="text" value="家长" />
                    </div>
                </div>

                <div class="weui-cell bang_list">
                    <div class="weui-cell__hd name_box"><label for="sex" class="weui-label">性别</label></div>
                    <div class="weui-cell__bd">
                        <input class="weui-input input_txt inputpointer" id="sex" type="text" data-values="1" value="男" />
                    </div>
                </div>

                <div class="bang_list">
                    <div class="name_box">
                        <label for="nianling">年龄</label>
                    </div>
                    <div class="input_box">
                        <input class="input_txt" id="nianling" type="number" placeholder="请输入年龄" value="" />
                    </div>
                </div>
            </div>
        </div>

        <div class="cont">
            <div class="container2">
                <div class="weui-cell bang_list">
                    <div class="weui-cell__hd name_box"><label for="city" class="weui-label">所在地</label></div>
                    <div class="weui-cell__bd city_wrap">
                        <input class="weui-input input_txt inputpointer" id="city" type="text" value="" placeholder="请选择所在地">
                    </div>
                </div>

                <div class="weui-cell bang_list">
                    <div class="weui-cell__hd name_box"><label for="trade" class="weui-label">行业</label></div>
                    <div class="weui-cell__bd">
                        <input class="weui-input input_txt inputpointer" id="trade" type="text" data-values="" value="" placeholder="请选择行业" />
                    </div>
                </div>

                <div class="bang_list">
                    <div class="name_box">
                        <label for="email">邮箱</label>
                    </div>
                    <div class="input_box">
                        <input class="input_txt" id="email" type="text" placeholder="请输入您的邮箱">
                    </div>
                </div>
            </div>
        </div>

        <div class="bang_submit_box" style="padding-top: 100px;">
            <input class="bang_submit" type="button" value="保 存" />
        </div>

    </div>


    <script src="../content/scripts/jquery.min.js"></script>
    <script src="../content/plugins/jqweui/lib/fastclick.js"></script>
    <script src="../content/plugins/jqweui/js/jquery-weui.js"></script>
    <script src="../content/plugins/jqweui/js/city-picker.js"></script>
    <script src="../content/scripts/commom.js"></script>
    <script src="../content/scripts/API.js"></script>

    <script>
        $(function() {

            // 获取个人信息
            $.ajax({
                type: "POST",
                url: api + '/Member/info.html',
                data: {
                    key: 'ddf85a32731291cfdb118750eace4626',
                    member_id: 2
                },
                dataType: "json",
                success: function(response) {
                    if (response['code'] == 200) {
                        console.log(response)
                        img_name = response['result']['member_avatar'];
                        $('.user_img').attr('src', response['result']['member_avatar']);
                        $('#nickname').val(response['result']['member_nickname']);
                        switch (response['result']['member_identity']) {
                            case 1:
                                $('#shenfen').val('家长');
                                break;
                            case 2:
                                $('#shenfen').val('教师');
                                break;
                            case 3:
                                $('#shenfen').val('其他');
                                break;
                        }
                        switch (response['result']['member_sex']) {
                            case 0:
                                $('#sex').val('保密');
                                break;
                            case 1:
                                $('#sex').val('男');
                                break;
                            case 2:
                                $('#sex').val('女');
                                break;
                        }
                        $('#nianling').val(response['result']['member_age']);
                        $('#email').val(response['result']['member_email']);
                        $('#city').get(0).dataset.code = response['result']['member_provinceid'];
                        $('#city').get(0).dataset.codes = response['result']['member_provinceid'] + ',' + response['result']['member_cityid'] + ',' + response['result']['member_areaid'];
                        $('#city').val(response['result']['province_name'] + ' ' + response['result']['city_name'] + ' ' + response['result']['area_name']);
                        $('#trade').val(response['result']['job_name'])
                        $('#trade').get(0).dataset.values = response['result']['member_jobid']
                    };
                }
            });

            var img_name = '';
            // 行业信息数据
            var hangye = [];
            // 获取行业信息
            $.ajax({
                type: "POST",
                url: api + '/Common/industry.html',
                async: false,
                data: {
                    key: token
                },
                dataType: "json",
                success: function(response) {
                    hangye = response['result']
                }
            });

            // 身份选择
            $("#shenfen").picker({
                title: "请选择您的身份",
                cols: [{
                    textAlign: 'center',
                    values: ['家长', '教师', '其他']
                }],
                onChange: function(p, v, dv) {},
                onClose: function(p, v, d) {}
            });

            // 性别选择
            $("#sex").picker({
                title: "请选择您的性别",
                cols: [{
                    textAlign: 'center',
                    values: ['男', '女', '保密']
                }],
                onChange: function(p, v, dv) {},
                onClose: function(p, v, d) {}
            });

            // 行业选择
            $("#trade").select({
                title: "请选择行业",
                items: hangye,
                onChange: function(p, v, dv) {},
                onClose: function(p, v, d) {}
            });

            // 所在地区选择
            $("#city").cityPicker({
                title: "请选择所在地",
                onChange: function(picker, values, displayValues) {
                    // $("h1:contains(选择所在地)").parents(".weui-picker-modal").height("16rem");
                }
            });

            // 上传头像
            fileChange = function(event) {
                img_name = event.target.files['0'].name;
            }

            $('.bang_submit').on('click', function() {
                if (!Tools.IsEmail($("#email").val())) {
                    $.alert("请输入正确的邮箱地址");
                }


                修改个人信息
                var params = {};
                params['key'] = token;
                params['member_id'] = 2;
                params['member_nickname'] = $('#nickname').val();
                switch ($('#shenfen').val()) {
                    case '家长':
                        params['member_identity'] = 1;
                        break;
                    case '教师':
                        params['member_identity'] = 2;
                        break;
                    case '其他':
                        params['member_identity'] = 3;
                        break;
                }
                params['member_age'] = $('#nianling').val();
                switch ($('#sex').val()) {
                    case '保密':
                        params['member_sex'] = 0;
                        break;
                    case '男':
                        params['member_sex'] = 1;
                        break;
                    case '女':
                        params['member_sex'] = 2;
                        break;
                }
                params['member_email'] = $('#email').val();
                params['member_avatar'] = img_name;
                params['member_provinceid'] = $('#city').get(0).dataset.codes.split(',')[0];
                params['member_cityid'] = $('#city').get(0).dataset.codes.split(',')[1];
                params['member_areaid'] = $('#city').get(0).dataset.codes.split(',')[2];
                params['member_jobid'] = $('#trade').get(0).dataset.values;
                $.ajax({
                    type: "POST",
                    url: api + '/Member/addInfo.html',
                    data: params,
                    dataType: "json",
                    success: function(response) {
                        if (response['code'] == 200) {
                            $.toast(response['result']['message'])
                        }
                    },
                    error(error) {
                        $.toast(error)
                    }
                });
            })

        })

        var Tools = {
            // 是否为空
            IsNull: function(str) {
                return str == null || typeof(str) == "undefined" || str == "";
            },

            //判断是否是手机号
            IsPhoneNum: function(str) {
                var myreg = /^1\d{10}$/;
                return myreg.test(str);
            },

            //判断是否是邮箱地址
            IsEmail: function(str) {
                var myreg = /^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/;
                return myreg.test(str);
            }
        }
    </script>
</body>

</html>