<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8" />
    <title>想见孩-绑定学生</title>
    <meta name="author" content="想见孩" />
    <meta name="copyright" content="想见孩" />
    <meta name="description" content="想见孩" />
    <meta id="viewport" name="viewport" content="width=750" />
    <link rel="stylesheet" href="../content/style/reset.css" type="text/css" />
    <link rel="stylesheet" href="../content/plugins/iconfonts/iconfont.css" type="text/css" />
    <link rel="stylesheet" href="../content/plugins/jqweui/lib/weui.css" type="text/css" />
    <link rel="stylesheet" href="../content/plugins/jqweui/css/jquery-weui.css" type="text/css" />
    <link rel="stylesheet" href="../content/style/common.css" type="text/css" />
    <link rel="stylesheet" href="../content/style/user.css" type="text/css" />
    <link rel="shortcut icon" href="../content/images/ico.ico" type="image/x-icon" />
    <script src="../content/scripts/mobile-util.js"></script>
</head>

<body>
    <header class="head">
        <div class="head0">
            <div class="menu_bar_box">
                <!--  <a href="javascript:;" class="back_btn" onClick="javascript :history.back(-1);">
                 <i class="icon iconfont icon-jiantou3"></i>
                 </a> -->
                <a href="javascript:;" class="back_btn" onClick="historyback()">
                    <i class="icon iconfont icon-jiantou3"></i>
                </a>
            </div>
            <div class="head_title">
                <p>绑定学生</p>
            </div>
            <div class="head_r">
                <a href="javascript:;">
                    <i class="icon iconfont icon-saoyisao"></i>
                </a>
            </div>
        </div>
    </header>

    <!-- 主要内容 -->
    <div class="main">
        <div class="container2">
            <div class="bang_list">
                <div class="name_box">
                    <label for="bang_name"><span class="redstar">*</span>姓名</label>
                </div>
                <div class="input_box">
                    <input class="input_txt" id="bang_name" type="text" placeholder="请输入您的姓名">
                </div>
            </div>

            <div class="weui-cell bang_list">
                <div class="weui-cell__hd name_box"><label for="sex" class="weui-label">性别</label></div>
                <div class="weui-cell__bd">
                    <input class="weui-input input_txt inputpointer" id="sex" type="text" value="女">
                </div>
            </div>

            <div class="weui-cell bang_list">
                <div class="weui-cell__hd name_box"><label for="date" class="weui-label">生日</label></div>
                <div class="weui-cell__bd">
                    <input class="weui-input input_txt inputpointer" id="date" type="text" value="" placeholder="请选择生日">
                </div>
            </div>

            <div class="weui-cell bang_list">
                <div class="weui-cell__hd name_box"><label for="city" class="weui-label"><span class="redstar">*</span>所在地</label></div>
                <div class="weui-cell__bd">
                    <input class="weui-input input_txt inputpointer" id="city" type="text" value="" placeholder="请选择地址">
                </div>
            </div>

            <div class="weui-cell bang_list">
                <div class="weui-cell__hd name_box"><label for="school" class="weui-label"><span class="redstar">*</span>就读学校</label></div>
                <div class="weui-cell__bd">
                    <input class="weui-input input_txt inputpointer" id="school" type="text" data-values="" value="" placeholder="请先选择所在地">
                </div>
            </div>

            <div class="weui-cell bang_list">
                <div class="weui-cell__hd name_box"><label for="classes" class="weui-label"><span class="redstar">*</span>所在年级</label></div>
                <div class="weui-cell__bd">
                    <input class="weui-input input_txt inputpointer" id="classes" type="text" data-values="" value="" placeholder="请先选择所在学校">
                </div>
            </div>

            <div class="weui-cell bang_list">
                <div class="weui-cell__hd name_box"><label for="banji" class="weui-label"><span class="redstar">*</span>班级</label></div>
                <div class="weui-cell__bd">
                    <input class="weui-input input_txt inputpointer" id="banji" type="text" data-values="" value="" placeholder="请先选择所在年级">
                </div>
            </div>

            <div class="bang_list">
                <div class="name_box">
                    <label for="shibiema"><span class="redstar">*</span>班级识别码</label>
                </div>
                <div class="input_box">
                    <input class="input_txt" id="shibiema" type="text" placeholder="请输入班级识别码">
                </div>
            </div>

            <div class="weui-cell bang_list">
                <div class="weui-cell__hd name_box"><label class="weui-label">看孩套餐</label></div>
                <div class="weui-cell__bd">
                    <a href="javascript:;" class="input_txt color_blue">2019/09/20 到期</a>
                </div>
            </div>

            <div class="bang_submit_box">
                <input id="bang_submit" class="bang_submit" type="button" value="提 交" />
            </div>
        </div>


        <script src="../content/scripts/jquery.min.js"></script>
        <!-- <script src="../content/plugins/jqweui/lib/fastclick.js"></script> -->
        <script src="../content/plugins/jqweui/js/jquery-weui.js"></script>
        <script src="../content/plugins/jqweui/js/city-picker.js"></script>
        <script src="../content/scripts/commom.js"></script>
        <script src="../content/scripts/API.js"></script>
        <script src="../content/scripts/regular.js"></script>

        <script>
            $(function() {

                // 性别选择
                $("#sex").picker({
                    title: "请选择您的性别",
                    cols: [{
                        textAlign: 'center',
                        values: ['男', '女']
                    }],
                });

                //生日选择
                $("#date").calendar({
                    onChange: function(p, values, displayValues) {}
                });

                // 所在地区选择
                $("#city").cityPicker({
                    title: "请选择所在地",
                    onClose: function(picker) {
                        $.ajax({
                            type: "POST",
                            url: api + '/Common/school.html',
                            data: {
                                key: token,
                                province: picker.value[0],
                                city: picker.value[1],
                                area: picker.value[2]
                            },
                            dataType: "json",
                            success: function(response) {
                                $("#school").select("update", {
                                    items: response['result']
                                })
                            }
                        });
                    }
                });

                // 学校就读选择
                var schollID = '';
                $("#school").select({
                    title: "请选择学校",
                    items: [{}],
                    onClose: function(p, v, d) {
                        schollID = p.data.values;
                        $.ajax({
                            type: "POST",
                            url: api + '/Common/grade.html',
                            data: {
                                key: token,
                                school_id: p.data.values
                            },
                            dataType: "json",
                            success: function(response) {
                                $("#classes").select("update", {
                                    items: response['result']
                                })
                            }
                        });
                    }
                });

                //年级选择
                $("#classes").select({
                    title: "请选择所在年级",
                    items: [{}],
                    onClose: function(p, v, d) {
                        $.ajax({
                            type: "POST",
                            url: api + '/Common/classData.html',
                            data: {
                                key: token,
                                school_id: schollID,
                                grade_id: p.data.values
                            },
                            dataType: "json",
                            success: function(response) {
                                console.log(response)
                                $("#banji").select("update", {
                                    items: response['result']
                                })
                            }
                        });
                    }
                });

                //班级选择
                $("#banji").select({
                    title: "请选择所在班级",
                    items: [{}],
                    onClose: function(p, v, d) {

                    }
                });

            })

            //绑定学生的提交操作
            $("#bang_submit").click(function() {
                if ($("#bang_name").val() == '') {
                    $.alert("请先填写孩子的姓名")
                } else if ($("#city").val() == '') {
                    $.alert("请选择所在地")
                } else if ($("#school").val() == '') {
                    $.alert("请选择孩子就读学校")
                } else if ($("#classes").val() == '') {
                    $.alert("请选择孩子所在年级")
                } else if ($("#banji").val() == '') {
                    $.alert("请选择孩子的班级")
                } else if ($("#shibiema").val() == '') {
                    $.alert("请填写班级识别码")
                } else {
                    //ActionName：原生中对应的方法名；parameter：回传的参数
                    //json传递参数
                    var params = new Object();
                    params['key'] = token;
                    params['member_id'] = 2;
                    params["name"] = $('#bang_name').val();
                    switch ($('#sex').val()) {
                        case '男':
                            params["sex"] = 1;
                            break;
                        case '女':
                            params["sex"] = 2;
                            break;
                    }
                    params["birthday"] = $('#date').val().split('/')[0] + '-' + $('#date').val().split('/')[1] + '-' + $('#date').val().split('/')[2];
                    params["province"] = $('#city').get(0).dataset.codes.split(',')[0];
                    params["city"] = $('#city').get(0).dataset.codes.split(',')[1];
                    params["area"] = $('#city').get(0).dataset.codes.split(',')[2];
                    params["school"] = $('#school').get(0).dataset.values;
                    params['grade'] = $('#classes').get(0).dataset.values;
                    params['class'] = $('#banji').get(0).dataset.values;
                    // params['class'] = 15;
                    params['class_code'] = $('#shibiema').val();
                    params['card'] = 10;
                    $.ajax({
                        type: "POST",
                        url: api + '/Member/studentBind.html',
                        data: params,
                        dataType: "json",
                        success: function(response) {
                            $.alert(response['message'])
                        }
                    });

                }
            })

            //返回操作
            function back(param) {
                if (plateType() == 1) {
                    //安卓
                    alert("设备不支持")
                } else {
                    window.webkit.messageHandlers.backClick.postMessage('back!!');
                }
            }

            //判读是什么设备
            function plateType() {
                var u = navigator.userAgent;
                var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Adr') > -1; //android终端
                var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
                if (isAndroid) {
                    return 1;
                } else {
                    return 0;
                }
            }
        </script>
</body>

</html>